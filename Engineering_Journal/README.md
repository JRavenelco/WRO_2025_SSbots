# Engineering Journal

This folder contains updates on the changes the team has made to the robot. As an overview the design process was a follows.

# Design development
Our robot design for this competition started with the base platform, at first we thought about using a prebuilt chassis with integrated motors as those found [online](https://www.amazon.com.mx/Yahboom-completo-neum%C3%A1ticos-superiores-opcionales/dp/B0BR9PGZWN?th=1) since this would solve the issue of mechanical design and more time would be allocated onto software development and integration of the other hardware components. As we progressed we realized that we would still require the design to include more custom components and mounts for the hardware that was not designed for it.
In addition, the back traction system on the previous prebuilt chassis was operated by two direct coupled motors on each side of the vehicle to provide the forward and backward propulsion with the shift in direction provided by a third motor which control the [Ackerman steering](https://en.wikipedia.org/wiki/Ackermann_steering_geometry). According to the WRO rules for the 2025 season:

> 11.12. Teams can use any electrical DC motors and/or servo motors of their choice – there are no restrictions on brand of motors and/or servos used.
> 11.13. A maximum of two motors may be used to make the vehicle move forward or backward (i.e., driving the robot, these are the driving motors). The driving motors must all be connected directly to the axle turning the wheels, or indirectly through a gearing system. The two driving motors may not be connected independently of each other to the driving wheels.

That´s why after some more design and brainstorming sessions we concluded we would require more work than initially planned. But still, this kind of design and system to mount the components was considered a great idea, which could be replicated with our own design.

![Ackerman Chassis](https://www.researchgate.net/publication/379066275/figure/fig5/AS:11431281232098540@1711624752318/Construction-of-four-wheel-driving-Akerman-carrier-chassis.tif)

## First design Iteration (Full LEGO Chassis)
One of the skills we have developed from our time in Robomission is the design of custom structures and mechanisms with the LEGO Technic system. Even though it is limiting because of how tight some components can be when integrated, and the pieces are predesigned, it allows for a standard system to be employed for integration with the definition of base Technic units well documented and the use of many prebuilt elements for rapid prototyping.
[https://i.sstatic.net/83RL2.png](url)
This left us with the decision to either integrate custom or commercial electronic components or use those available in the LEGO Mindstorms system. We decided to implement two strategies:
- **Short term:** use the LEGO Mindstorms components to have an available robot platform to progress with software development.
- **Explore the development of custom hardware:** for electronics (power delivery and progress onto the embedded systems) and mechanical components to integrate in future iterations of the robot.

This iteration of the design was built onto a custom LEGO Technic platform with Ackerman steering with one [Technic Large Angular Motor](https://assets.education.lego.com/v3/assets/blt293eea581807678a/bltb9abb42596a7f1b3/5f8801b5f4c5ce0e93db1587/le_spike-prime_tech-fact-sheet_45602_1hy19.pdf?locale=es-mx) for propulsion and one [Technic Medium Angular Motor](https://assets.education.lego.com/v3/assets/blt293eea581807678a/blt692436dd1e8fa71c/5f8801d5c8a27c1d9614c27e/techspecs_technicmediumangularmotor.pdf?locale=es-mx) for steering, initially we planned to use one Technic Small Angular Motor, but additional torque was required by the transmission. For reference the website [Philo Home](https://www.philohome.com/motors/motorcomp.htm) provides a great reference and comparison of the entire catalog of LEGO motors available. Sensing for obstacles is handled by an array of sensors similar to the strategies currently used in commercial vehicles:
- Short range with the use of [Technic Distance Sensors](https://assets.education.lego.com/v3/assets/blt293eea581807678a/blt64c2b9534cf10f68/5f8801b8bc43790f5c4389ea/techspecs_technicdistancesensor.pdf?locale=es-mx) .
- Front range mapping with the use of [LiDAR](https://www.slamtec.com/en/lidar/a1).
- Obstacle and object detection with the use of a [camera](https://docs.luxonis.com/hardware/products/OAK-D%20Lite).

The camera from Luxonis was selected due to the prospective capabilities it presents. The embedded TPU Mobidius from Intel allows to carry out the processing directly on the device reducing the workload on the Raspberry Pi and allocating resources better designed for this task. The camera also includes and array of three lenses with two being monochromatic for stereo vision and depth perception and the third for color vision. This results in the data being represented in a 4D array for RGB and the distance value for the object present in each pixel. Each sensor is specialized for certain operating conditions covering the weaknesses of each other and providing possible fallback options in case one is not operating properly (to be implemented).

The compute and processing side is handled by a Master-slave controller with the [Technic Large HUB](https://assets.education.lego.com/v3/assets/blt293eea581807678a/bltf512a371e82f6420/5f8801baf4f4cf0fa39d2feb/techspecs_techniclargehub.pdf?locale=es-mx) in charge of the lower level control and interface onto the rest of the Mindstorms components, executing commands received through a serial communication using a USB link in interpreter mode and a Raspberry Pi 5 in charge of data processing and decision making.

Power delivery is handled by a combination of the integrated power delivery network of the Large HUB and a custom one with a 4S Li-Ion battery pack and a commercial regulator from [Traco Power](https://www.tracopower.com/int/series/tmdc-20) to provide a steady 5V for the Raspberry Pi and the camera.
Based on our tests for power consumption each battery pack with 2200mAh is capable of providing a runtime of 3 hours with the steady state current consumption of 650mA and up to 1 hour with full load at the average peak current consumption of 1880mA. This would enable us to go through a round without having a degradation of performance due to the battery discharge.

## Second Design Iteration
After the regional friendly competition, checking out the other teams designs and progressing more onto the challenges we could not solve at that time, we decided to completely redesign the robot. We needed to asses the simultaneous object detection and navigation aspects for mapping the location of the objects not just detecting them with the camera and improve on the weight distribution and traction system. We decided to include a LIDAR sensor at the front and TOF sensors arround the robot to map the objects in the track and detect the proximity of the walls while reverse parcking. For the mechanical redesign the parts where iteratively customized as to optimize weight distribution and remove unnecesary weight and volume from the robot.

The key aspect for this redesign is a unibody chassis onto which all the other components are mounted, this allowed to have a lighter design with only the required mounting points and customized for each of the components.
For this point we initially started by recerating in CAD the main components in the chassis joined together as to reduce the amount of components and have them with a lower in fill percentage as to reduce their density and weight, also having a single main part largely reduced the amount of connectors required, and their weight. As a next step we iterated on to the design of the mounting bases for the electronic components, Raspberry Pi, TOF Sensors, etc. until we had a designed that complied with the weight limitations and the expected functionality we had.

Next modifications were on the power delivery, we changed to a less efficient but lighter to output 5V for the camera and Raspberry Pi and the design of the batteries. Previously we had the batteries mounted as a 2X2 square in a 4S configuration which we later regulated to 5V, this was planned as to have enough power for larger motors in case needed but as we stuck with the LEGO SPIKE motors we only needed a output >5V to ensure a steady regulation. We decided to increase capacity to 6 cells in a 2S3P configuration, this allowed to have a 7.2V to 8.4V output that we could use with either the Raspberry Pi LEGO HAT to control the motors or regulate to 5V while using the LEGO HUB for control. This was mounted in a upside down "U" configuration to surrround the trasmission motor and reduce volume on the robot. For this we designed a custom case for safe transport and montiing for easy swap in the robot.

The main mechanical issue that had to be resolved was the distortion of the wheels movement because of the robot's weight, the wheels sagged and generated mechanical losses and additional friction for the increase area of contact. The traction and direction mechanisms that made up the bottom of the robot were redesigned same as the main body by joining the parts and making the mecanisms more rigid with less flex and give so that the wheels remained straight with less mechanical losses.

Down the line we continued performing minor modifications as we saw issues appear and mitigated them. We added a relay to control when the LEGO Hub USB powe lines are connected (this current draw overloaded the USB power delivery in the raspberry Pi because the HUB starded to charge its internal battery). We added the power startup and power switches to comply with the startup regulations for the robot. Modifications were necesary on the mounting mecanism of the battery to reduce the weight and reduce the replacement compelxity. The chassis front structure had to be modified as the side detection on the lidar was being obstructed. 
